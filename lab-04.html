<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Lab 4: Bicycle Stability and Control | EME 134: Vehicle Stability
</title>
  <link rel="canonical" href="https://moorepants.github.io/eme134/lab-04.html">


  <link rel="stylesheet" href="https://moorepants.github.io/eme134/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://moorepants.github.io/eme134/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://moorepants.github.io/eme134/theme/css/pygments/emacs.min.css">
  <link rel="stylesheet" href="https://moorepants.github.io/eme134/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://moorepants.github.io/eme134/feeds/all.atom.xml">
  
  <meta name="description" content="Draft This lab is still a draft, there may be some minor changes before Monday May 11. Contents Learning Objectives Introduction System Description Equations of Motion Inputs Outputs Constant Parameters Initial Conditions Time Steps Eigenvalues and Stability Using a Root Locus To Choose a Feedback Gain Checking your work Deliverables …">
  <script>
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o);
      a.async = 1;
      a.src = g;
      m = s.getElementsByTagName(o)[0];
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-15966419-8', 'auto');
    ga('send', 'pageview');
  </script>


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
  <div class="col-sm-12">
    <h1 class="title"><a href="https://moorepants.github.io/eme134/">EME 134: Vehicle Stability</a></h1>
      <ul class="list-inline">
            <li class="list-inline-item"><a href="https://moorepants.github.io/eme134/">Syllabus</a></li>
            <li class="list-inline-item"><a href="https://moorepants.github.io/eme134/schedule.html">Schedule</a></li>
            <li class="list-inline-item"><a href="https://moorepants.github.io/eme134/labs.html">Labs</a></li>
            <li class="list-inline-item"><a href="https://moorepants.github.io/eme134/resources.html">Resources</a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  Lab 4: Bicycle Stability and Control
</h1>
      <hr>

<article class="article">
  <div class="content">
    <div class="alert alert-warning topic">
<p class="topic-title">Draft</p>
<p>This lab is still a draft, there may be some minor changes before Monday May
11.</p>
</div>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#learning-objectives" id="id3">Learning Objectives</a></li>
<li><a class="reference internal" href="#introduction" id="id4">Introduction</a></li>
<li><a class="reference internal" href="#system-description" id="id5">System Description</a><ul>
<li><a class="reference internal" href="#equations-of-motion" id="id6">Equations of Motion</a></li>
<li><a class="reference internal" href="#inputs" id="id7">Inputs</a></li>
<li><a class="reference internal" href="#outputs" id="id8">Outputs</a></li>
<li><a class="reference internal" href="#constant-parameters" id="id9">Constant Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#initial-conditions" id="id10">Initial Conditions</a></li>
<li><a class="reference internal" href="#time-steps" id="id11">Time Steps</a></li>
<li><a class="reference internal" href="#eigenvalues-and-stability" id="id12">Eigenvalues and Stability</a></li>
<li><a class="reference internal" href="#using-a-root-locus-to-choose-a-feedback-gain" id="id13">Using a Root Locus To Choose a Feedback Gain</a></li>
<li><a class="reference internal" href="#checking-your-work" id="id14">Checking your work</a></li>
<li><a class="reference internal" href="#deliverables" id="id15">Deliverables</a></li>
<li><a class="reference internal" href="#assessment-rubric" id="id16">Assessment Rubric</a></li>
</ul>
</div>
<div class="section" id="learning-objectives">
<h2><a class="toc-backref" href="#id3">Learning Objectives</a></h2>
<p>After completing this lab you will be able to:</p>
<ul class="simple">
<li>formulate the explicit first order ordinary differential equations for the
roll and steer dynamics of a bicycle</li>
<li>translate ordinary differential equations into a computer function that
evaluates the equations at any given point in time</li>
<li>develop a function that evaluates state dependent input functions</li>
<li>develop a function that evaluates state and input dependent output variables</li>
<li>numerically integrate ordinary differential equations with Octave/Matlab's
<a class="reference external" href="https://www.mathworks.com/help/matlab/ref/ode45.html">ode45</a></li>
<li>create complete and legible plots of the resulting input, state, and output
trajectories</li>
<li>create a report with textual explanations and plots of the simulation</li>
</ul>
<div class="alert alert-info topic">
<p class="topic-title">Information</p>
<p>Extra information (asides) are in blue boxes.</p>
</div>
<div class="alert alert-warning topic">
<p class="topic-title">Warnings</p>
<p>Warnings are in yellow boxes.</p>
</div>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id4">Introduction</a></h2>
<p>In this lab, you will investigate the dynamics of a bicycle with and without a
controller to assist in balancing. Bicycles and motorcycles share the same core
dynamic behavior, so this lab will introduce you to phenomena that apply to
both vehicles. Below is a video that demonstrates a bicycle's uncanny ability
to be self-stable, i.e. return to an upright configuration even when perturbed
from its equilibrium. This is, of course, not always possible as we know that a
bicycle will simply fall over if it has no forward speed and we also know that
bicycles require some control from the rider in general. In this lab, you will
simulate the Whipple-Carvallo bicycle model, investigate its dynamics, apply a
controller to stabilize it at low speeds, and design a bicycle that can
self-stabilize at lower speeds.</p>
<iframe width="560" height="315"
src="https://www.youtube.com/embed/pOkDbXEJb8E" frameborder="0"
allow="accelerometer; autoplay; encrypted-media; gyroscope;
picture-in-picture" allowfullscreen></iframe></div>
<div class="section" id="system-description">
<h2><a class="toc-backref" href="#id5">System Description</a></h2>
<p>The Whipple-Carvallo bicycle model is essentially the simplest model that
behaves like a bicycle and can exhibit self-stability, i.e. uncontrolled
stability.  The model was developed by both Whipple and Carvallo around the
turn of the 20th century. In 2007, Meijaard, Papdopoulos, Ruina, and Schwab
validated the model and presented a benchmark formulation <a class="citation-reference" href="#meijaard2007" id="id1">[Meijaard2007]</a>.
You'll be using this formulation for the lab. This model assumes no-slip
non-deforming tires, a flat level surface, frictionless revolute joints, and a
human rider that is rigidly fixed to the rear bicycle frame. See the cited
paper for more details about the history of the model, its derivation, and
in-depth analysis. Figure 1 shows the basic geometry and the four rigid bodys:
[B] rear frame and human body, [H] handlebar and fork, [R] rear wheel, and [F]
front wheel.</p>
<div class="figure align-center">
<img alt="" src="https://moorepants.github.io/resonance/14/bicycle-model.jpg" />
<p class="caption"><strong>Figure 1</strong>: Schematic of the benchmark bicycle model.</p>
</div>
<table class="docutils citation" frame="void" id="meijaard2007" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[Meijaard2007]</a></td><td>J.P Meijaard, Jim M Papadopoulos, Andy Ruina and A.L Schwab, 2007,
Linearized dynamics equations for the balance and steer of a bicycle: a
benchmark and review, Proc. R. Soc. A. 4631955–1982
<a class="reference external" href="http://doi.org/10.1098/rspa.2007.1857">http://doi.org/10.1098/rspa.2007.1857</a></td></tr>
</tbody>
</table>
<div class="section" id="equations-of-motion">
<h3><a class="toc-backref" href="#id6">Equations of Motion</a></h3>
<p>The equations of motion for the Whipple-Carvallo benchmark bicycle model are
presented below in a canonical-like linear form:</p>
<div class="math">
\begin{equation*}
\mathbf{M}\ddot{\bar{q}} + v\mathbf{C}_1\dot{\bar{q}} +
\left[g\mathbf{K}_0 + v^2\mathbf{K}_2\right]\bar{q} = \bar{F}
\end{equation*}
</div>
<p>where</p>
<div class="math">
\begin{align*}
\bar{q} = &amp; [\phi \quad \delta]^T \\
\bar{F} = &amp; [T_\phi \quad T_\delta]^T
\end{align*}
</div>
<p>The time varying variables are:</p>
<table border="1" class="table table-striped table-bordered docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Symbol</th>
<th class="head">Description</th>
<th class="head">Units</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><span class="math">\(\phi\)</span></td>
<td>Roll angle of the bicycle's rear frame relative to the ground. Positive
about the x axis (rightward lean).</td>
<td><span class="math">\(\textrm{rad}\)</span></td>
</tr>
<tr><td><span class="math">\(\delta\)</span></td>
<td>Steer angle; angle between handlebar + fork and rear frame. Positive is
rotation about the ~z axis (rightward steer).</td>
<td><span class="math">\(\textrm{rad}\)</span></td>
</tr>
<tr><td><span class="math">\(\omega=\dot{\phi}\)</span></td>
<td>Roll angular rate.</td>
<td><span class="math">\(\textrm{rad/s}\)</span></td>
</tr>
<tr><td><span class="math">\(\beta=\dot{\delta}\)</span></td>
<td>Steer angular rate.</td>
<td><span class="math">\(\textrm{rad/s}\)</span></td>
</tr>
<tr><td><span class="math">\(T_\phi\)</span></td>
<td>Roll torque (between ground and rear frame)</td>
<td><span class="math">\(\textrm{N}\cdot\textrm{m}\)</span></td>
</tr>
<tr><td><span class="math">\(T_\delta\)</span></td>
<td>Steer torque (between rear frame and handlebar + fork)</td>
<td><span class="math">\(\textrm{N}\cdot\textrm{m}\)</span></td>
</tr>
</tbody>
</table>
<p>You will need to formulate the equations of motion as four explicit linear
ordinary differential equations in first order form for your state derivative
function. The state space form is a good best way to do this:</p>
<div class="math">
\begin{equation*}
\dot{\bar{x}} = \mathbf{A} \bar{x} + \mathbf{B} \bar{u}
\end{equation*}
</div>
<p>where</p>
<div class="math">
\begin{align*}
\bar{x} = &amp; [\phi \quad \delta \quad \omega \quad \beta]^T \\
\bar{u} = &amp; \bar{F}
\end{align*}
</div>
<p>Use matrix algebra to determine <span class="math">\(A\)</span> and <span class="math">\(B\)</span> from the canonical form
matrices.</p>
<p>You will use the section <a class="reference external" href="https://moorepants.github.io/eme171/ode-integration-best-practices-with-octavematlab.html#defining-the-state-derivative-function">Defining the State Derivative Function</a>
for these equations.</p>
</div>
<div class="section" id="inputs">
<h3><a class="toc-backref" href="#id7">Inputs</a></h3>
<p>You will examine two inputs scenarios:</p>
<dl class="docutils">
<dt>No control</dt>
<dd><span class="math">\(T_\phi\)</span> and <span class="math">\(T_\delta\)</span> should both be set to zero for all time.
These inputs will be used to examine the self-stability of the bicycle.</dd>
<dt>Roll rate feedback control</dt>
<dd><p class="first">Define an input function that applies a steer torque <span class="math">\(T_\delta\)</span>
proportional to the negative roll angular rate. This is a classic &quot;negative
feedback&quot; controller that will attempt to drive the roll rate to zero. The
controller equation is:</p>
<div class="last math">
\begin{equation*}
T_\delta = -k\omega
\end{equation*}
</div>
</dd>
</dl>
<p>See <a class="reference external" href="https://moorepants.github.io/eme171/ode-integration-best-practices-with-octavematlab.html#time-varying-inputs">Time Varying Inputs</a>
for more information.</p>
</div>
<div class="section" id="outputs">
<h3><a class="toc-backref" href="#id8">Outputs</a></h3>
<p>The output function should return all of the state variables and the steering
torque input. Include these five time varying variables in your simulation
plots. You will use the section <a class="reference external" href="https://moorepants.github.io/eme171/ode-integration-best-practices-with-octavematlab.html#outputs-other-than-the-states">Outputs Other Than The States</a>
to compute these values.</p>
</div>
<div class="section" id="constant-parameters">
<h3><a class="toc-backref" href="#id9">Constant Parameters</a></h3>
<p>The majority of the variables in the differential equations and input equations
above do not vary with time, i.e. they are constant. Below is a table with an
explanation of each variable, its value, and its units. Note that the units are
a self consistent set of SI base units. The values given represent a typical
bicycle and rider.</p>
<table border="1" class="table table-striped table-bordered docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Symbol</th>
<th class="head">Matlab variable</th>
<th class="head">Description</th>
<th class="head">Value</th>
<th class="head">Units</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><span class="math">\(I_{Bxx}\)</span></td>
<td><tt class="docutils literal">IBxx</tt></td>
<td>Rear frame and human body x moment of inertia</td>
<td>9.2</td>
<td><span class="math">\(\textrm{kg}\cdot\textrm{m}^2\)</span></td>
</tr>
<tr><td><span class="math">\(I_{Bxz}\)</span></td>
<td><tt class="docutils literal">IBxz</tt></td>
<td>Rear frame and human body xz product of inertia</td>
<td>2.4</td>
<td><span class="math">\(\textrm{kg}\cdot\textrm{m}^2\)</span></td>
</tr>
<tr><td><span class="math">\(I_{Byy}\)</span></td>
<td><tt class="docutils literal">IByy</tt></td>
<td>Rear frame and human body y moment of inertia</td>
<td>11.0</td>
<td><span class="math">\(\textrm{kg}\cdot\textrm{m}^2\)</span></td>
</tr>
<tr><td><span class="math">\(I_{Bzz}\)</span></td>
<td><tt class="docutils literal">IBzz</tt></td>
<td>Rear frame and human body z moment of inertia</td>
<td>2.8</td>
<td><span class="math">\(\textrm{kg}\cdot\textrm{m}^2\)</span></td>
</tr>
<tr><td><span class="math">\(I_{Fxx}\)</span></td>
<td><tt class="docutils literal">IFxx</tt></td>
<td>Front wheel radial moment of inertia</td>
<td>0.1405</td>
<td><span class="math">\(\textrm{kg}\cdot\textrm{m}^2\)</span></td>
</tr>
<tr><td><span class="math">\(I_{Fyy}\)</span></td>
<td><tt class="docutils literal">IFyy</tt></td>
<td>Front wheel spin moment of inertia</td>
<td>0.28</td>
<td><span class="math">\(\textrm{kg}\cdot\textrm{m}^2\)</span></td>
</tr>
<tr><td><span class="math">\(I_{Hxx}\)</span></td>
<td><tt class="docutils literal">IHxx</tt></td>
<td>Handlebar and fork x moment of inertia</td>
<td>0.05892</td>
<td><span class="math">\(\textrm{kg}\cdot\textrm{m}^2\)</span></td>
</tr>
<tr><td><span class="math">\(I_{Hxz}\)</span></td>
<td><tt class="docutils literal">IHxz</tt></td>
<td>Handlebar and fork xz product of inertia</td>
<td>-0.00756</td>
<td><span class="math">\(\textrm{kg}\cdot\textrm{m}^2\)</span></td>
</tr>
<tr><td><span class="math">\(I_{Hyy}\)</span></td>
<td><tt class="docutils literal">IHyy</tt></td>
<td>Handlebar and fork y moment of inertia</td>
<td>0.06</td>
<td><span class="math">\(\textrm{kg}\cdot\textrm{m}^2\)</span></td>
</tr>
<tr><td><span class="math">\(I_{Hzz}\)</span></td>
<td><tt class="docutils literal">IHzz</tt></td>
<td>Handlebar and fork z moment of inertia</td>
<td>0.00708</td>
<td><span class="math">\(\textrm{kg}\cdot\textrm{m}^2\)</span></td>
</tr>
<tr><td><span class="math">\(I_{Rxx}\)</span></td>
<td><tt class="docutils literal">IRxx</tt></td>
<td>Rear wheel radial moment of inertia</td>
<td>0.0603</td>
<td><span class="math">\(\textrm{kg}\cdot\textrm{m}^2\)</span></td>
</tr>
<tr><td><span class="math">\(I_{Ryy}\)</span></td>
<td><tt class="docutils literal">IRyy</tt></td>
<td>Rear wheel spin moment of inertia</td>
<td>0.12</td>
<td><span class="math">\(\textrm{kg}\cdot\textrm{m}^2\)</span></td>
</tr>
<tr><td><span class="math">\(c\)</span></td>
<td><tt class="docutils literal">c</tt></td>
<td>Trail</td>
<td>0.08</td>
<td><span class="math">\(\textrm{m}\)</span></td>
</tr>
<tr><td><span class="math">\(g\)</span></td>
<td><tt class="docutils literal">g</tt></td>
<td>Acceleration due to gravity</td>
<td>9.81</td>
<td><span class="math">\(\textrm{m/s}^2\)</span></td>
</tr>
<tr><td><span class="math">\(\lambda\)</span></td>
<td><tt class="docutils literal">lambda</tt></td>
<td>Steer axis tilt</td>
<td><span class="math">\(\pi/10\)</span></td>
<td><span class="math">\(\textrm{rad}\)</span></td>
</tr>
<tr><td><span class="math">\(m_B\)</span></td>
<td><tt class="docutils literal">mB</tt></td>
<td>Mass of rear frame and human body</td>
<td>85.0</td>
<td><span class="math">\(\textrm{kg}\)</span></td>
</tr>
<tr><td><span class="math">\(m_F\)</span></td>
<td><tt class="docutils literal">mF</tt></td>
<td>Mass of front wheel</td>
<td>3.0</td>
<td><span class="math">\(\textrm{kg}\)</span></td>
</tr>
<tr><td><span class="math">\(m_H\)</span></td>
<td><tt class="docutils literal">mH</tt></td>
<td>Mass of handlebar and fork</td>
<td>4.0</td>
<td><span class="math">\(\textrm{kg}\)</span></td>
</tr>
<tr><td><span class="math">\(m_R\)</span></td>
<td><tt class="docutils literal">mR</tt></td>
<td>Mass of rear wheel</td>
<td>2.0</td>
<td><span class="math">\(\textrm{kg}\)</span></td>
</tr>
<tr><td><span class="math">\(r_F\)</span></td>
<td><tt class="docutils literal">rF</tt></td>
<td>Radius of front wheel</td>
<td>0.35</td>
<td><span class="math">\(\textrm{m}\)</span></td>
</tr>
<tr><td><span class="math">\(r_R\)</span></td>
<td><tt class="docutils literal">rR</tt></td>
<td>Radius of rear wheel</td>
<td>0.3</td>
<td><span class="math">\(\textrm{m}\)</span></td>
</tr>
<tr><td><span class="math">\(w\)</span></td>
<td><tt class="docutils literal">w</tt></td>
<td>Wheelbase</td>
<td>1.02</td>
<td><span class="math">\(\textrm{m}\)</span></td>
</tr>
<tr><td><span class="math">\(x_B\)</span></td>
<td><tt class="docutils literal">xB</tt></td>
<td>Rear frame and human body mass center x coordinate</td>
<td>0.3</td>
<td><span class="math">\(\textrm{m}\)</span></td>
</tr>
<tr><td><span class="math">\(x_H\)</span></td>
<td><tt class="docutils literal">xH</tt></td>
<td>Handlebar and fork mass center x coordinate</td>
<td>0.9</td>
<td><span class="math">\(\textrm{m}\)</span></td>
</tr>
<tr><td><span class="math">\(z_B\)</span></td>
<td><tt class="docutils literal">zB</tt></td>
<td>Rear frame and human body mass center z coordinate</td>
<td>-0.9</td>
<td><span class="math">\(\textrm{m}\)</span></td>
</tr>
<tr><td><span class="math">\(z_H\)</span></td>
<td><tt class="docutils literal">zH</tt></td>
<td>Handlebar and fork mass center z coordinate</td>
<td>-0.7</td>
<td><span class="math">\(\textrm{m}\)</span></td>
</tr>
<tr><td><span class="math">\(v\)</span></td>
<td><tt class="docutils literal">v</tt></td>
<td>Speed, positive is forward.</td>
<td>varies</td>
<td><span class="math">\(\textrm{m/s}\)</span></td>
</tr>
<tr><td><span class="math">\(k\)</span></td>
<td><tt class="docutils literal">k</tt></td>
<td>Control gain</td>
<td>varies</td>
<td><span class="math">\(\textrm{Nms}\)</span></td>
</tr>
</tbody>
</table>
<p>The following function <a class="reference external" href="https://moorepants.github.io/eme134/scripts/compute_benchmark_bicycle_matrices.m"><tt class="docutils literal">compute_benchmark_bicycle_matrices.m</tt></a> computes
<span class="math">\(\mathbf{M,C1,K0,K2}\)</span> given a structure with the above constant
parameters defined. Use this function along with your m-files to setup your
model.</p>
<div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>[M, C1, K0, K2] <span class="p">=</span><span class="w"> </span><span class="nf">compute_benchmark_bicycle_matrices</span><span class="p">(</span>p<span class="p">)</span><span class="w"></span>
<span class="c">% COMPUTE_BENCHMARK_BICYCLE_MATRICES - Returns the canonical matrices of the</span>
<span class="c">% benchmark Whipple-Carvallo bicycle model linearized about the upright</span>
<span class="c">% constant velocity configuration. It uses the parameter definitions from:</span>
<span class="c">%</span>
<span class="c">% J.P Meijaard, Jim M Papadopoulos, Andy Ruina and A.L Schwab, 2007,</span>
<span class="c">% Linearized dynamics equations for the balance and steer of a bicycle: a</span>
<span class="c">% benchmark and review, Proc. R. Soc. A. 4631955–1982</span>
<span class="c">% http://doi.org/10.1098/rspa.2007.1857</span>
<span class="c">%</span>
<span class="c">% Syntax: [M, C1, K0, K2] = compute_benchmark_bicycle_matrices(p)</span>
<span class="c">%</span>
<span class="c">% Inputs:</span>
<span class="c">% p - structure</span>
<span class="c">%     A dictionary of the benchmark bicycle parameters. Make sure your units</span>
<span class="c">%     are correct and match the benchmark paper&#39;s units.</span>
<span class="c">%</span>
<span class="c">% Outputs:</span>
<span class="c">% M - matrix, size 2x2</span>
<span class="c">%     The mass matrix.</span>
<span class="c">% C1 - matrix, size 2x2</span>
<span class="c">%     The part of the damping matrix that is proportional to the speed, v.</span>
<span class="c">% K0 - matrix, size 2x2</span>
<span class="c">%     The part of the stiffness matrix proportional to gravity, g.</span>
<span class="c">% K2 - matrix, size 2x2</span>
<span class="c">%     The part of the stiffness matrix proportional to the speed squared,</span>
<span class="c">%     v^2.</span>

<span class="n">mT</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">mR</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">mB</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">mH</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">mF</span><span class="p">;</span>
<span class="n">xT</span> <span class="p">=</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xB</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">mB</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">xH</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">mH</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">w</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">mF</span><span class="p">)</span><span class="o">/</span><span class="n">mT</span><span class="p">;</span>
<span class="n">zT</span> <span class="p">=</span> <span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">rR</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">mR</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">zB</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">mB</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">zH</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">mH</span> <span class="o">-</span> <span class="n">p</span><span class="p">.</span><span class="n">rF</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">mF</span><span class="p">)</span><span class="o">/</span><span class="n">mT</span><span class="p">;</span>

<span class="n">ITxx</span> <span class="p">=</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">IRxx</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">IBxx</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">IHxx</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">IFxx</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">mR</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">rR</span>^<span class="mi">2</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">mB</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">zB</span>^<span class="mi">2</span> <span class="o">+</span> <span class="c">...</span>
        <span class="n">p</span><span class="p">.</span><span class="n">mH</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">zH</span>^<span class="mi">2</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">mF</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">rF</span>^<span class="mi">2</span><span class="p">);</span>
<span class="n">ITxz</span> <span class="p">=</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">IBxz</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">IHxz</span> <span class="o">-</span> <span class="n">p</span><span class="p">.</span><span class="n">mB</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">xB</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">zB</span> <span class="o">-</span> <span class="n">p</span><span class="p">.</span><span class="n">mH</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">xH</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">zH</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">mF</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">w</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">rF</span><span class="p">);</span>
<span class="n">p</span><span class="p">.</span><span class="n">IRzz</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">IRxx</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">IFzz</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">IFxx</span><span class="p">;</span>
<span class="n">ITzz</span> <span class="p">=</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">IRzz</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">IBzz</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">IHzz</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">IFzz</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">mB</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">xB</span>^<span class="mi">2</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">mH</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">xH</span>^<span class="mi">2</span> <span class="o">+</span> <span class="c">...</span>
        <span class="n">p</span><span class="p">.</span><span class="n">mF</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">w</span>^<span class="mi">2</span><span class="p">);</span>

<span class="n">mA</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">mH</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">mF</span><span class="p">;</span>
<span class="n">xA</span> <span class="p">=</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xH</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">mH</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">w</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">mF</span><span class="p">)</span><span class="o">/</span><span class="n">mA</span><span class="p">;</span>
<span class="n">zA</span> <span class="p">=</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">zH</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">mH</span> <span class="o">-</span> <span class="n">p</span><span class="p">.</span><span class="n">rF</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">mF</span><span class="p">)</span><span class="o">/</span><span class="n">mA</span><span class="p">;</span>

<span class="n">IAxx</span> <span class="p">=</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">IHxx</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">IFxx</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">mH</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">zH</span> <span class="o">-</span> <span class="n">zA</span><span class="p">)</span>^<span class="mi">2</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">mF</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">rF</span> <span class="o">+</span> <span class="n">zA</span><span class="p">)</span>^<span class="mi">2</span><span class="p">);</span>
<span class="n">IAxz</span> <span class="p">=</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">IHxz</span> <span class="o">-</span> <span class="n">p</span><span class="p">.</span><span class="n">mH</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xH</span> <span class="o">-</span> <span class="n">xA</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">zH</span> <span class="o">-</span> <span class="n">zA</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">mF</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">w</span> <span class="o">-</span> <span class="n">xA</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">rF</span> <span class="o">+</span> <span class="c">...</span>
        <span class="n">zA</span><span class="p">));</span>
<span class="n">IAzz</span> <span class="p">=</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">IHzz</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">IFzz</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">mH</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xH</span> <span class="o">-</span> <span class="n">xA</span><span class="p">)</span>^<span class="mi">2</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">mF</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">w</span> <span class="o">-</span> <span class="n">xA</span><span class="p">)</span>^<span class="mi">2</span><span class="p">);</span>
<span class="n">uA</span> <span class="p">=</span> <span class="p">(</span><span class="n">xA</span> <span class="o">-</span> <span class="n">p</span><span class="p">.</span><span class="n">w</span> <span class="o">-</span> <span class="n">p</span><span class="p">.</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">)</span> <span class="o">-</span> <span class="n">zA</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">);</span>
<span class="n">IAll</span> <span class="p">=</span> <span class="p">(</span><span class="n">mA</span><span class="o">*</span><span class="n">uA</span>^<span class="mi">2</span> <span class="o">+</span> <span class="n">IAxx</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">)</span>^<span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">IAxz</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">)</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">)</span> <span class="o">+</span> <span class="c">...</span>
        <span class="n">IAzz</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">)</span>^<span class="mi">2</span><span class="p">);</span>
<span class="n">IAlx</span> <span class="p">=</span> <span class="p">(</span><span class="o">-</span><span class="n">mA</span><span class="o">*</span><span class="n">uA</span><span class="o">*</span><span class="n">zA</span> <span class="o">+</span> <span class="n">IAxx</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">)</span> <span class="o">+</span> <span class="n">IAxz</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">));</span>
<span class="n">IAlz</span> <span class="p">=</span> <span class="p">(</span><span class="n">mA</span><span class="o">*</span><span class="n">uA</span><span class="o">*</span><span class="n">xA</span> <span class="o">+</span> <span class="n">IAxz</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">)</span> <span class="o">+</span> <span class="n">IAzz</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">));</span>

<span class="n">mu</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">c</span><span class="o">/</span><span class="n">p</span><span class="p">.</span><span class="n">w</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">);</span>

<span class="n">SR</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">IRyy</span><span class="o">/</span><span class="n">p</span><span class="p">.</span><span class="n">rR</span><span class="p">;</span>
<span class="n">SF</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">IFyy</span><span class="o">/</span><span class="n">p</span><span class="p">.</span><span class="n">rF</span><span class="p">;</span>
<span class="n">ST</span> <span class="p">=</span> <span class="n">SR</span> <span class="o">+</span> <span class="n">SF</span><span class="p">;</span>
<span class="n">SA</span> <span class="p">=</span> <span class="n">mA</span><span class="o">*</span><span class="n">uA</span> <span class="o">+</span> <span class="n">mu</span><span class="o">*</span><span class="n">mT</span><span class="o">*</span><span class="n">xT</span><span class="p">;</span>

<span class="n">Mpp</span> <span class="p">=</span> <span class="n">ITxx</span><span class="p">;</span>
<span class="n">Mpd</span> <span class="p">=</span> <span class="n">IAlx</span> <span class="o">+</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">ITxz</span><span class="p">;</span>
<span class="n">Mdp</span> <span class="p">=</span> <span class="n">Mpd</span><span class="p">;</span>
<span class="n">Mdd</span> <span class="p">=</span> <span class="n">IAll</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="n">IAlz</span> <span class="o">+</span> <span class="n">mu</span>^<span class="mi">2</span><span class="o">*</span><span class="n">ITzz</span><span class="p">;</span>
<span class="n">M</span> <span class="p">=</span> <span class="p">[</span><span class="n">Mpp</span><span class="p">,</span> <span class="n">Mpd</span><span class="p">;</span> <span class="n">Mdp</span><span class="p">,</span> <span class="n">Mdd</span><span class="p">];</span>

<span class="n">K0pp</span> <span class="p">=</span> <span class="n">mT</span><span class="o">*</span><span class="n">zT</span><span class="p">;</span>
<span class="n">K0pd</span> <span class="p">=</span> <span class="o">-</span><span class="n">SA</span><span class="p">;</span>
<span class="n">K0dp</span> <span class="p">=</span> <span class="n">K0pd</span><span class="p">;</span>
<span class="n">K0dd</span> <span class="p">=</span> <span class="o">-</span><span class="n">SA</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">);</span>
<span class="n">K0</span> <span class="p">=</span> <span class="p">[</span><span class="n">K0pp</span><span class="p">,</span> <span class="n">K0pd</span><span class="p">;</span> <span class="n">K0dp</span><span class="p">,</span> <span class="n">K0dd</span><span class="p">];</span>

<span class="n">K2pp</span> <span class="p">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="n">K2pd</span> <span class="p">=</span> <span class="p">(</span><span class="n">ST</span> <span class="o">-</span> <span class="n">mT</span><span class="o">*</span><span class="n">zT</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">.</span><span class="n">w</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">);</span>
<span class="n">K2dp</span> <span class="p">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="n">K2dd</span> <span class="p">=</span> <span class="p">(</span><span class="n">SA</span> <span class="o">+</span> <span class="n">SF</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">))</span><span class="o">/</span><span class="n">p</span><span class="p">.</span><span class="n">w</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">);</span>
<span class="n">K2</span> <span class="p">=</span> <span class="p">[</span><span class="n">K2pp</span><span class="p">,</span> <span class="n">K2pd</span><span class="p">;</span> <span class="n">K2dp</span><span class="p">,</span> <span class="n">K2dd</span><span class="p">];</span>

<span class="n">C1pp</span> <span class="p">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="n">C1pd</span> <span class="p">=</span> <span class="p">(</span><span class="n">mu</span><span class="o">*</span><span class="n">ST</span> <span class="o">+</span> <span class="n">SF</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">)</span> <span class="o">+</span> <span class="n">ITxz</span><span class="o">/</span><span class="n">p</span><span class="p">.</span><span class="n">w</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">)</span> <span class="o">-</span> <span class="n">mu</span><span class="o">*</span><span class="n">mT</span><span class="o">*</span><span class="n">zT</span><span class="p">);</span>
<span class="n">C1dp</span> <span class="p">=</span> <span class="o">-</span><span class="p">(</span><span class="n">mu</span><span class="o">*</span><span class="n">ST</span> <span class="o">+</span> <span class="n">SF</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">));</span>
<span class="n">C1dd</span> <span class="p">=</span> <span class="p">(</span><span class="n">IAlz</span><span class="o">/</span><span class="n">p</span><span class="p">.</span><span class="n">w</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">)</span> <span class="o">+</span> <span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="n">SA</span> <span class="o">+</span> <span class="n">ITzz</span> <span class="o">/</span> <span class="n">p</span><span class="p">.</span><span class="n">w</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">lambda</span><span class="p">)));</span>
<span class="n">C1</span> <span class="p">=</span> <span class="p">[</span><span class="n">C1pp</span><span class="p">,</span> <span class="n">C1pd</span><span class="p">;</span> <span class="n">C1dp</span><span class="p">,</span> <span class="n">C1dd</span><span class="p">];</span>

<span class="n">end</span>
</pre></div>
<p>You will use the section <a class="reference external" href="https://moorepants.github.io/eme171/ode-integration-best-practices-with-octavematlab.html#integrating-the-equations">Integrating the Equations</a>
to for these values.</p>
</div>
</div>
<div class="section" id="initial-conditions">
<h2><a class="toc-backref" href="#id10">Initial Conditions</a></h2>
<p>For the simulations, set the initial conditions as:</p>
<div class="math">
\begin{equation*}
\bar{x}(0) = [5 \textrm{ deg} \quad -2 \textrm{ deg} \quad 0 \quad 0]^T
\end{equation*}
</div>
<p>This will start the vehicle off with a small roll and steer angle. See
<a class="reference external" href="https://moorepants.github.io/eme171/ode-integration-best-practices-with-octavematlab.html#integrating-the-equations">Integrating the Equations</a>
for how to set up the initial condition vector. Make sure that your initial
conditions are arranged in the same order as your state variables.</p>
</div>
<div class="section" id="time-steps">
<h2><a class="toc-backref" href="#id11">Time Steps</a></h2>
<p>Simulate the system for 5 seconds with time steps of 1/100th of a second.</p>
</div>
<div class="section" id="eigenvalues-and-stability">
<h2><a class="toc-backref" href="#id12">Eigenvalues and Stability</a></h2>
<p>Matlab and Octave can easily calculate the roots of the characteristic
equation, i.e. the eigenvalues, given a state dynamics matrix
<span class="math">\(\mathbf{A}\)</span>.  The <tt class="docutils literal">eig()</tt> function calculates the eigenvalues. It is
used like so:</p>
<div class="highlight"><pre><span></span><span class="n">evals</span> <span class="p">=</span> <span class="n">eig</span><span class="p">(</span><span class="n">A</span><span class="p">);</span>
</pre></div>
<p>The variable <tt class="docutils literal">evals</tt> will then contain a vector of eigenvalues. The functions
<tt class="docutils literal">real()</tt> and <tt class="docutils literal">imag()</tt> are also helpful to extract the real and imaginary
parts of the complex eigenvalues.</p>
<p>See the Matlab documentation for more about these functions:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.mathworks.com/help/matlab/ref/eig.html">https://www.mathworks.com/help/matlab/ref/eig.html</a></li>
<li><a class="reference external" href="https://www.mathworks.com/help/matlab/ref/real.html">https://www.mathworks.com/help/matlab/ref/real.html</a></li>
<li><a class="reference external" href="https://www.mathworks.com/help/matlab/ref/imag.html">https://www.mathworks.com/help/matlab/ref/imag.html</a></li>
</ul>
<div class="alert alert-warning topic">
<p class="topic-title">Plotting the eigenvalues</p>
<p>The bicycle's stability is speed dependent, so it will be useful to plot the
real part of the eigenvalues versus the speed <span class="math">\(v\)</span> to determine this
relationship. Make sure to only plot a dot for each data point, otherwise
you'll get a very hard to interpret plot, e.g.:</p>
<div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">speeds</span><span class="p">,</span> <span class="n">real_part_of_evals</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="using-a-root-locus-to-choose-a-feedback-gain">
<h2><a class="toc-backref" href="#id13">Using a Root Locus To Choose a Feedback Gain</a></h2>
<p>A <a class="reference external" href="https://en.wikipedia.org/wiki/Root_locus">root locus</a> is a parametric plot of the complex plane that shows how the
roots of the characteristic equation change with respect to changes in a single
parameter in a linear model. Any parameter can be chosen but the most common
parameter is a proportional control gain of a closed loop negative feedback
controller. It turns out that the Whipple-Carvallo bicycle model can be
stabilized by &quot;steering into the fall&quot;. One way to formalize this statement is
to apply steer torque in the direction of the roll angular rate, i.e. if you
roll towards the right, steer towards the right. You'll first need to determine
the transfer function that relates the steer torque input <span class="math">\(T_\delta\)</span> to
the roll angular rate <span class="math">\(\omega\)</span>:</p>
<div class="math">
\begin{equation*}
\frac{\omega(s)}{T_\delta(s)}
\end{equation*}
</div>
<p>You can use <a class="reference external" href="https://en.wikipedia.org/wiki/Cramer%27s_rule">Cramer's rule</a> to find this transfer function, as in the book, or
there are various Matlab/Octave functions that can help, for example
<tt class="docutils literal">ss2tf()</tt> can convert a state space system to equivalent transfer functions.
If you use Cramer's rule you'll need to use the <tt class="docutils literal">tf()</tt> function to construct
the transfer function in Matlab/Octave. There isn't any reason to do any
algebra by hand, use Matlab/Octave to do the number crunching.</p>
<p>Once you have a transfer function you can use the <tt class="docutils literal">rlocus()</tt> function to make
a standard root locus plot as a function of the negative feedback gain
<span class="math">\(k\)</span>. You'll need to examine this plot to determine what gain value
ensures that all roots are in the left half of the complex plane.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.mathworks.com/help/matlab/ref/ss2tf.html">https://www.mathworks.com/help/matlab/ref/ss2tf.html</a></li>
<li><a class="reference external" href="https://www.mathworks.com/help/matlab/ref/tf.html">https://www.mathworks.com/help/matlab/ref/tf.html</a></li>
<li><a class="reference external" href="https://www.mathworks.com/help/control/ref/tf.rlocus.html">https://www.mathworks.com/help/control/ref/tf.rlocus.html</a></li>
</ul>
<div class="alert alert-warning topic">
<p class="topic-title">Sign of the feedback gain</p>
<p>The root locus function assumes a negative feedback gain, i.e. that
<span class="math">\(T_\delta=-k\omega\)</span>, thus you provide a positive value of the gain to
get negative feedback. Think very carefully about the &quot;steer into the fall&quot;
and the sign conventions of the state variables. You'll need to setup your
root locus to examine gains that cause a &quot;steer into the fall&quot;.</p>
</div>
</div>
<div class="section" id="checking-your-work">
<h2><a class="toc-backref" href="#id14">Checking your work</a></h2>
<p>You can use the BicycleParameters web app to visualize the bicycle geometry and
to double check your eigenvalue plots. Visit the app here:</p>
<p><a class="reference external" href="http://bicycleparameters.herokuapp.com/">http://bicycleparameters.herokuapp.com/</a></p>
<p>This app was recently developed by a UCD physics undergraduate, Noah Sanders,
and is powered by similar calculations that you are doing in this lab. It is
still in beta and there may be some bugs, but you should be able to edit the
parameters in the table to see changes in the two figures.</p>
</div>
<div class="section" id="deliverables">
<h2><a class="toc-backref" href="#id15">Deliverables</a></h2>
<p>In your lab report, show your work for creating and evaluating the simulation
model. Include any calculations you had to do, for example those for state
equations, initial conditions, input equations, time parameters, and any other
parameters. Additionally, provide the indicated plots and answer the questions
below. Append a copy of your Matlab/Octave code to the end of the report. The
report should follow the <a class="reference external" href="https://moorepants.github.io/eme134/report-guide.html">report template and guidelines</a>.</p>
<p>Submit a report as a single PDF file to Canvas by the due date that addresses
the following items:</p>
<ol class="arabic">
<li><p class="first">Create a function defined in an m-file that evaluates the right hand side of
the ODEs, i.e. evaluates the state derivatives. See <a class="reference external" href="https://moorepants.github.io/eme171/ode-integration-best-practices-with-octavematlab.html#defining-the-state-derivative-function">Defining the State
Derivative Function</a> for an explanation.</p>
</li>
<li><p class="first">Create two functions defined each in an m-file that calculates the two
requested inputs: no control and with control. See <a class="reference external" href="https://moorepants.github.io/eme171/ode-integration-best-practices-with-octavematlab.html#time-varying-inputs">Time Varying Inputs</a>
for an explanation.</p>
</li>
<li><p class="first">Create a function defined in an m-file that calculates the requested
outputs. See <a class="reference external" href="https://moorepants.github.io/eme171/ode-integration-best-practices-with-octavematlab.html#outputs-other-than-the-states">Outputs Other Than the States</a>  and <a class="reference external" href="https://moorepants.github.io/eme171/ode-integration-best-practices-with-octavematlab.html#outputs-involving-state-derivatives">Outputs Involving State
Derivatives</a> for an explanation.</p>
</li>
<li><p class="first">Create a script in an m-file that utilizes the above functions to simulate
system for the scenarios described below. This should setup the constants,
integrate the dynamics equations, and plot each state, and output versus
time. See <a class="reference external" href="https://moorepants.github.io/eme171/ode-integration-best-practices-with-octavematlab.html#integrating-the-equations">Integrating the Equations</a> for an explanation.</p>
</li>
<li><p class="first">Make a plot where the Y axis is the real part of the eigenvalues (determines
growth or decay and the rate) and the X axis is the bicycle speed. The
speeds should vary from 0 to 10 m/s (0 to ~22 mph). Discuss how the bicycle's
self-stability relates to the speed and discuss any speed values that stand
out and what the eigenvalues at this speed tell you about the motion. Use
simulation (states vs time: 0 to 5 seconds) plots to back up your
explanations at the particular speeds of interest. Be sure to explain your
simulation plots in terms of growth/decay rates, oscillation frequencies,
and phase differences in the states. Limit your Y axis to +/- 90 degs for
unstable simulations.</p>
</li>
<li><p class="first">Develop three roll angular rate feedback controllers using a root locus to
select an appropriate gain to stabilize the bicycle at 0.2 m/s, 2 m/s, and 8
m/s. Choose gains that give realistic decay rates and oscillation
frequencies (a human's arm control bandwidth has an upper bound of about 10
rad/s). Simulate the system at these speeds with the controller defined in
an input function to show that the system is stable. Discuss the gain values
and any relationship to speed you may see.</p>
</li>
<li><p class="first">Design a bicycle by changing any number of the parameters values so that it
is self-stable (no control) at a very low range of speeds. Try not to choose
parameter values that would be impossible to actually build, e.g. a
wheelbase that is 100 meters long or rear frame/human mass of 1 kg. There is
no single solution to this. Once you chose a bike, simulate it at a very low
speed and discuss the simulation results and the advantages/disadvantages of
the bicycle design. A practical use of a bicycle that is self-stable at low
speeds could be to make it easy for people to learn to ride a bicycle. The
videos below show bicycles designed for low-speed stability:</p>
<iframe width="560" height="315"
src="https://www.youtube.com/embed/VFeNpyd7Ng8" frameborder="0"
allow="accelerometer; autoplay; encrypted-media; gyroscope;
picture-in-picture" allowfullscreen></iframe><iframe width="560" height="315"
src="https://www.youtube.com/embed/YmtPNIu4WI0" frameborder="0"
allow="accelerometer; autoplay; encrypted-media; gyroscope;
picture-in-picture" allowfullscreen></iframe></li>
</ol>
</div>
<div class="section" id="assessment-rubric">
<h2><a class="toc-backref" href="#id16">Assessment Rubric</a></h2>
<table border="1" class="table table-striped table-bordered docutils">
<caption>Score will be between 50 and 100.</caption>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Topic</th>
<th class="head">[10 pts] Exceeds expectations</th>
<th class="head">[5 pts] Meets expectatoins</th>
<th class="head">[0 pts] Does not meet expectations</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Functions</td>
<td>All Matlab/Octave functions are present and take correct inputs and
produce the expected outputs.</td>
<td>Some of the functions are present and mostly take correct inputs and
produce the expected outputs</td>
<td>No functions are present or not working at all.</td>
</tr>
<tr><td>Main Script</td>
<td>Constant parameters only defined once in main script(s);
Integration produces the correct state, input, and output trajectories;
Good choices in number of time steps and resolution are chosen and
justified.</td>
<td>Parameters are defined in multiple places; Integration produces some
correct state, input, and output trajectories; Poor choices in number of
time steps and resolution are chosen</td>
<td>Constants defined redundantly; Integration produces incorrect
trajectories; Poor choices in time duration and steps</td>
</tr>
<tr><td>Explanations</td>
<td>Explanation of three simulation comparisons are correct and well
explained; Plots of appropriate variables are used in the explanations</td>
<td>Explanation of three simulation comparisons is somewhat correct and
reasonably explained; Plots of appropriate variables are used in the
explanations, but some are missing</td>
<td>Explanation of three simulations are incorrect and poorly explained; Plots
are missing</td>
</tr>
<tr><td>Report and Code Formatting</td>
<td>All axes labeled with units, legible font sizes, informative captions;
Functions are documented with docstrings which fully explain the inputs
and outputs; Professional, very legible, quality writing; All report
format requirements met</td>
<td>Some axes labeled with units, mostly legible font sizes,
less-than-informative captions; Functions have docstrings but the inputs
and outputs are not fully explained; Semi-professional, somewhat
legible, writing needs improvement; Most report format requirements met</td>
<td>Axes do not have labels, legible font sizes, or informative captions;
Functions do not have docstrings; Report is not professionally written
and formatted; Report format requirements are not met</td>
</tr>
<tr><td>Contributions</td>
<td>Clear that all team members have made equitable contributions.</td>
<td>Not clear that contributions were equitable and you need to improve
balance of contributions.</td>
<td>No indication of equitable contributions.</td>
</tr>
</tbody>
</table>
</div>
<script type='text/javascript'>if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
  </div>
</article>


    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
      <li class="list-inline-item"><a href="https://moorepants.github.io/eme134/authors.html">Authors</a></li>
    <li class="list-inline-item"><a href="https://moorepants.github.io/eme134/archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="https://moorepants.github.io/eme134/categories.html">Categories</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>
<div class="row">
  <div class="col-sm-4 mx-auto text-center text-muted" >
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    <br />
    This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
  </div>
</div>    </div>
  </footer>
</body>

</html>